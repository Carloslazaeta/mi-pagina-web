<script>
    // URL del Google Sheet en formato JSON
    const sheetURL = "https://docs.google.com/spreadsheets/d/129nnMs3yOcnYcNSkRVoobSQIh5q1uWN0eJ9I3JpFyIU/gviz/tq?tqx=out:json";

    // Obtener el par√°metro de la URL
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    async function loadProfileData() {
        let selectedName = getQueryParam("name");
        if (!selectedName) {
            document.getElementById("profileDetails").innerHTML = "<p>No se proporcion√≥ un nombre</p>";
            return;
        }

        document.getElementById("profileName").textContent = selectedName;

        try {
            const response = await fetch(sheetURL);
            const text = await response.text();
            const jsonData = JSON.parse(text.substring(47, text.length - 2));

            const rows = jsonData.table.rows;
            const headers = jsonData.table.cols.map(col => col.label); // Obtener los nombres de las columnas

            console.log("üìä Debug: Cabeceras detectadas", headers);

            let foundRow = null;

            // Buscar la fila que coincide con el nombre seleccionado
            for (let i = 1; i < rows.length; i++) {
                let row = rows[i].c;
                let firstName = row[1]?.v?.trim() || "";
                let lastName = row[2]?.v?.trim() || "";
                let fullName = `${firstName} ${lastName}`.trim();

                if (fullName === selectedName) {
                    foundRow = row;
                    break;
                }
            }

            if (foundRow) {
                let detailsHTML = "<ul>";
                headers.forEach((header, index) => {
                    if (header && foundRow[index]?.v) {
                        detailsHTML += `<li><strong>${header}:</strong> ${foundRow[index].v}</li>`;
                    }
                });
                detailsHTML += "</ul>";

                document.getElementById("profileDetails").innerHTML = detailsHTML;
            } else {
                document.getElementById("profileDetails").innerHTML = "<p>No se encontraron datos para este nombre.</p>";
            }

        } catch (error) {
            console.error("‚ùå Error al cargar los datos del perfil:", error);
            document.getElementById("profileDetails").innerHTML = "<p>Error al cargar los datos</p>";
        }
    }

    // Cerrar la ventana al presionar "Cancelar"
    document.getElementById("cancelBtn").addEventListener("click", () => {
        window.close();
    });

    // Confirmar la creaci√≥n del perfil
    document.getElementById("createBtn").addEventListener("click", () => {
        alert("Perfil creado para " + document.getElementById("profileName").textContent);
    });

    // Cargar los datos del perfil al abrir la p√°gina
    window.onload = loadProfileData;
</script>
