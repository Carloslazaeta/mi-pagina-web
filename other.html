<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Other Links</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>üîó Other Section</h1>
        <p>Search for employees from Google Sheets.</p>
    </header>

    <main class="button-container">
        <!-- Barra de b√∫squeda -->
        <div class="input-container">
            <input type="text" id="searchInput" placeholder="Search for a name..." onkeyup="filterList()">
        </div>

        <!-- ListBox con los nombres cargados desde Google Sheets -->
        <div class="list-container">
            <ul id="itemList"></ul>
        </div>

        <!-- Bot√≥n para abrir Profile.html en otra ventana -->
        <button id="createProfileBtn" onclick="openProfileWindow()" disabled>Create Profile</button>

        <div>
            <a href="index.html" class="back-btn">‚¨Ö Back to Home</a>
        </div>
    </main>

    <script>
        // URL del Google Sheet en formato JSON
        const sheetURL = "https://docs.google.com/spreadsheets/d/129nnMs3yOcnYcNSkRVoobSQIh5q1uWN0eJ9I3JpFyIU/gviz/tq?tqx=out:json";

        let allData = []; // Almacenar√° todos los nombres
        let selectedName = ""; // Nombre seleccionado

        async function loadGoogleSheetData() {
            try {
                const response = await fetch(sheetURL);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47, text.length - 2));

                const rows = jsonData.table.rows;
                console.log("üîç Debug: Todas las filas recibidas", rows);

                const list = document.getElementById("itemList");
                if (!list) {
                    console.error("‚ùå Elemento 'itemList' no encontrado en el DOM");
                    return;
                }

                list.innerHTML = ""; // Limpiar lista antes de agregar los datos
                allData = []; // Resetear datos previos

                // Recorrer todas las filas desde la segunda fila (ignorando encabezado)
                rows.forEach((row, index) => {
                    if (!row.c) return; // Si la fila est√° vac√≠a, la ignoramos

                    let firstName = row.c[1] && row.c[1].v ? row.c[1].v.toString().trim() : "";
                    let lastName = row.c[2] && row.c[2].v ? row.c[2].v.toString().trim() : "";

                    if (firstName !== "" || lastName !== "") { // Permitir nombres con solo una columna llena
                        let fullName = `${firstName} ${lastName}`.trim();
                        allData.push(fullName);

                        let listItem = document.createElement("li");
                        listItem.textContent = fullName;
                        listItem.onclick = () => selectName(fullName, listItem);
                        list.appendChild(listItem);
                    }
                });

                console.log("‚úÖ Nombres extra√≠dos:", allData);

                if (allData.length === 0) {
                    list.innerHTML = "<li>No data available</li>";
                }

            } catch (error) {
                console.error("‚ùå Error loading Google Sheets data:", error);
                const list = document.getElementById("itemList");
                if (list) {
                    list.innerHTML = "<li>Error loading data</li>";
                }
            }
        }

        // Funci√≥n para seleccionar un nombre y resaltarlo
        function selectName(name, element) {
            document.querySelectorAll("#itemList li").forEach(item => item.classList.remove("selected"));
            selectedName = name;
            element.classList.add("selected");
            document.getElementById("createProfileBtn").disabled = false;
        }

        // Funci√≥n para abrir Profile.html en otra ventana con el nombre seleccionado
        function openProfileWindow() {
            if (selectedName) {
                let url = `Profile.html?name=${encodeURIComponent(selectedName)}`;
                window.open(url, "_blank", "width=600,height=400");
            }
        }

        // Funci√≥n para filtrar la lista seg√∫n el texto ingresado en la barra de b√∫squeda
        function filterList() {
            let query = document.getElementById("searchInput").value.toLowerCase();
            let list = document.getElementById("itemList");
            list.innerHTML = "";

            let filteredData = allData.filter(name => name.toLowerCase().includes(query));

            if (filteredData.length === 0) {
                list.innerHTML = "<li>No results found</li>";
            } else {
                filteredData.forEach(name => {
                    let listItem = document.createElement("li");
                    listItem.textContent = name;
                    listItem.onclick = () => selectName(name, listItem);
                    list.appendChild(listItem);
                });
            }
        }

        // Cargar los datos al iniciar la p√°gina
        window.onload = loadGoogleSheetData;
    </script>

    <style>
        .selected {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        #createProfileBtn:disabled {
            background-color: grey;
            cursor: not-allowed;
        }
    </style>

</body>
</html>
