<script type="module">
    import { database, ref, set } from "./firebase.js";

    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    document.getElementById("saveBtn").addEventListener("click", async function () {
        const profileName = getQueryParam("name");
        if (!profileName) {
            alert("No profile name provided.");
            return;
        }

        const profileRef = ref(database, "profiles/" + profileName);
        const data = {
            status: document.getElementById("status").value,
            offerLetter: document.getElementById("offerLetter").value,
            drugTest: document.getElementById("drugTest").value,
            drugTestDate: document.getElementById("drugTestDate").value,
            backgroundCheck: document.getElementById("backgroundCheck").value,
            trainingStatus: document.getElementById("trainingStatus").value,
            trainingDate: document.getElementById("trainingDate").value,
            roadTest: document.getElementById("roadTest").value,
            roadTestDate: document.getElementById("roadTestDate").value,
            mecCertificate: document.getElementById("mecCertificate").value,
            jjkApplication: document.getElementById("jjkApplication").value,
            jjkApplicationDate: document.getElementById("jjkApplicationDate").value,
            i9Status: document.getElementById("i9Status").value,
            adpPayroll: document.getElementById("adpPayroll").value,
            employeeHandbook: document.getElementById("employeeHandbook").value,
            handbookAcknowledgment: document.getElementById("handbookAcknowledgment").value
        };

        try {
            await set(profileRef, data);
            alert("Profile saved successfully!");
        } catch (error) {
            console.error("Error saving profile:", error);
            alert("Error saving profile. Please try again.");
        }
    });
</script>
