<script type="module">
    import { database, ref, get } from "./firebase.js";

    async function loadProfileData() {
        const profileName = new URLSearchParams(window.location.search).get("name");
        if (!profileName) {
            document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>No name provided</td></tr>";
            return;
        }

        console.log("üîç Searching profile:", profileName);

        const profileRef = ref(database, "profiles/" + profileName);

        try {
            const snapshot = await get(profileRef);

            if (snapshot.exists()) {
                const data = snapshot.val();
                console.log("‚úÖ Profile Data:", data);

                // Verificar si los datos tienen la estructura correcta
                if (typeof data === "object") {
                    // Asignar valores a la tabla
                    document.getElementById("profileName").textContent = profileName;
                    document.getElementById("firstName").textContent = data.firstName || "N/A";
                    document.getElementById("lastName").textContent = data.lastName || "N/A";
                    document.getElementById("email").textContent = data.email || "N/A";
                    document.getElementById("phone").textContent = data.phone || "N/A";
                    document.getElementById("address").textContent = data.address || "N/A";

                    document.getElementById("status").textContent = data.status || "N/A";
                    document.getElementById("offerLetter").textContent = data.offerLetter || "N/A";
                    document.getElementById("drugTest").textContent = data.drugTest || "N/A";
                    document.getElementById("drugTestDate").textContent = data.drugTestDate || "N/A";
                    document.getElementById("backgroundCheck").textContent = data.backgroundCheck || "N/A";
                    document.getElementById("trainingStatus").textContent = data.trainingStatus || "N/A";
                    document.getElementById("trainingDate").textContent = data.trainingDate || "N/A";
                    document.getElementById("adpPayroll").textContent = data.adpPayroll || "N/A";
                    document.getElementById("employeeHandbook").textContent = data.employeeHandbook || "N/A";
                    document.getElementById("handbookAcknowledgment").textContent = data.handbookAcknowledgment || "N/A";
                    document.getElementById("jjkApplication").textContent = data.jjkApplication || "N/A";
                    document.getElementById("jjkApplicationDate").textContent = data.jjkApplicationDate || "N/A";
                    document.getElementById("mecCertificate").textContent = data.mecCertificate || "N/A";
                    document.getElementById("roadTest").textContent = data.roadTest || "N/A";
                    document.getElementById("roadTestDate").textContent = data.roadTestDate || "N/A";
                    document.getElementById("i9Status").textContent = data.i9Status || "N/A";
                } else {
                    console.warn("‚ö†Ô∏è Unexpected Data Format:", data);
                    document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>Unexpected data format.</td></tr>";
                }
            } else {
                console.warn("‚ö†Ô∏è No data found for:", profileName);
                document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>No data found.</td></tr>";
            }
        } catch (error) {
            console.error("‚ùå Error loading profile:", error);
            document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>Error loading data.</td></tr>";
        }
    }

    window.onload = loadProfileData;
</script>
