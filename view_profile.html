<script type="module">
    import { database, ref, get } from "./firebase.js";

    async function loadProfileData() {
        const profileName = new URLSearchParams(window.location.search).get("name");
        if (!profileName) {
            console.error("‚ùå No profile name provided in the URL");
            document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>No name provided</td></tr>";
            return;
        }

        console.log("üîç Searching profile:", profileName);

        const profileRef = ref(database, "profiles/" + profileName);

        try {
            const snapshot = await get(profileRef);

            if (snapshot.exists()) {
                const data = snapshot.val();
                console.log("‚úÖ Profile Data:", data);

                // Verificar si los elementos existen antes de asignar valores
                function setText(id, value) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value || "N/A";
                    } else {
                        console.warn(`‚ö†Ô∏è Element with id '${id}' not found.`);
                    }
                }

                // Asignar valores a los campos
                setText("profileName", profileName);
                setText("firstName", data.firstName);
                setText("lastName", data.lastName);
                setText("email", data.email);
                setText("phone", data.phone);
                setText("address", data.address);

                setText("status", data.status);
                setText("offerLetter", data.offerLetter);
                setText("drugTest", data.drugTest);
                setText("drugTestDate", data.drugTestDate);
                setText("backgroundCheck", data.backgroundCheck);
                setText("trainingStatus", data.trainingStatus);
                setText("trainingDate", data.trainingDate);
                setText("adpPayroll", data.adpPayroll);
                setText("employeeHandbook", data.employeeHandbook);
                setText("handbookAcknowledgment", data.handbookAcknowledgment);
                setText("jjkApplication", data.jjkApplication);
                setText("jjkApplicationDate", data.jjkApplicationDate);
                setText("mecCertificate", data.mecCertificate);
                setText("roadTest", data.roadTest);
                setText("roadTestDate", data.roadTestDate);
                setText("i9Status", data.i9Status);
            } else {
                console.warn("‚ö†Ô∏è No data found for:", profileName);
                document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>No data found.</td></tr>";
            }
        } catch (error) {
            console.error("‚ùå Error loading profile:", error);
            document.getElementById("profileDetails").innerHTML = "<tr><td colspan='2'>Error loading data.</td></tr>";
        }
    }

    window.onload = loadProfileData;
</script>
